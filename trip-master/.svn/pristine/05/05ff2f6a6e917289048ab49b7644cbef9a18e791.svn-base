<?xml version="1.0" encoding="UTF-8" ?>   
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="order">

	<resultMap id="order"
		type="com.newroad.tripmaster.dao.pojo.order.ProductOrder">
		<result column="id" property="orderId" />
		<result column="orderName" property="orderName" />
		<result column="orderType" property="orderType" />
		<result column="orderAmount" property="orderAmount" />
		<result column="payAmount" property="payAmount" />
		<result column="people" property="people" />
		<result column="tripProductId" property="tripProductId" />
		<result column="contactName" property="contactName" />
		<result column="contactPhone" property="contactPhone" />
		<result column="contactMail" property="contactMail" />
		<result column="status" property="status" />
		<result column="payStatus" property="payStatus" />
		<result column="luckerId" property="luckerId" />
		<result column="userId" property="userId" />
		<result column="tripStartDate" property="tripStartDate" />
		<result column="tripEndDate" property="tripEndDate" />
		<result column="orderTime" property="orderTime" />
		<result column="updateTime" property="updateTime" />
	</resultMap>


	<select id="selectProductOrderById" parameterType="java.lang.Long"
		resultMap="order">
		select * from product_order
		where userId = #{userId}
	</select>

	<select id="selectProductOrderByUser" parameterType="java.util.Map"
		resultMap="order">
		select * from product_order
		where userId = #{userId}
		and status = #{status}
	</select>

	<insert id="createOrder" parameterType="com.newroad.tripmaster.dao.pojo.order.ProductOrder"
		useGeneratedKeys="true" keyProperty="orderId">
		insert into
		product_order(orderName,orderType,orderAmount,payAmount,
		people, tripProductId,
		contactName, contactPhone, contactMail, status, payStatus, userId,
		tripStartDate, tripEndDate, orderTime, updateTime)
		values(#{orderName}, #{orderType}, #{orderAmount}, #{payAmount}, #{people},
		#{tripProductId}, #{contactName}, #{contactPhone}, #{contactMail}, 0,
		#{payStatus},  #{luckerId}, #{userId}, #{tripStartDate}, #{tripEndDate}, now(),
		now())
	</insert>

	<update id="updateOrderStatus" parameterType="java.util.Map">
		update
		product_order set
		status = #{status},
		payStatus = #{payStatus}
		updateTime = now()
		where id = #{orderId}
	</update>

	<update id="updateOrderByUser" parameterType="java.util.Map">
		update product_order set
		<if test="contactName != null">contactName=#{contactName},</if>
		<if test="contactPhone != null">contactPhone=#{contactPhone},</if> 
		<if test="contactMail != null">contactMail=#{contactMail},</if>
		updateTime = now()
		where id = #{orderId}
		and userId = #{userId}
		and status=#{status}
	</update>

</mapper>   