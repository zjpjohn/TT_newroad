package com.newroad.tripmaster.service.scenic;

import java.util.ArrayList;
import java.util.List;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.newroad.tripmaster.constant.JSONConvertor;
import com.newroad.tripmaster.dao.CustomizeRouteDao;
import com.newroad.tripmaster.dao.TripPOIRouteDao;
import com.newroad.tripmaster.dao.TripProductDao;
import com.newroad.tripmaster.dao.pojo.order.ProductOrder;
import com.newroad.tripmaster.dao.pojo.trip.CustomizeRoute;
import com.newroad.tripmaster.dao.pojo.trip.POIRoute;
import com.newroad.tripmaster.dao.pojo.trip.TripDayRoute;
import com.newroad.tripmaster.dao.pojo.trip.TripProduct;
import com.newroad.tripmaster.service.VoyagerServiceIf;
import com.newroad.util.apiresult.ServiceResult;

public class VoyagerService implements VoyagerServiceIf {

  private static Logger logger = LoggerFactory.getLogger(VoyagerService.class);

  private TripProductDao tripProductDao;

  private TripPOIRouteDao tripPOIRouteDao;

  private CustomizeRouteDao customizeRouteDao;

  public String saveTripProduct() {
    return null;
  }

  public ServiceResult<String> listTripProduct(Integer cityCode) {
    ServiceResult<String> result = new ServiceResult<String>();
    String jsonResult = null;
    List<TripProduct> tripProductList = tripProductDao.listTripProducts(cityCode);
    jsonResult = JSONConvertor.transformTripProducts2JSON(tripProductList);
    logger.info("Trip Product list:" + jsonResult);
    result.setBusinessResult(jsonResult);
    return result;
  }

  public ServiceResult<String> detailTripProduct(String productId) {
    ServiceResult<String> result = new ServiceResult<String>();
    String jsonResult = null;
    TripProduct tripProduct = tripProductDao.getTripProduct(productId);
    String tripRouteId = tripProduct.getTripRouteId();
    CustomizeRoute customizeRoute = customizeRouteDao.getCustomizeRoute(tripRouteId);
    List<TripDayRoute> dayRouteList=groupTripDayRoute(tripRouteId);
    customizeRoute.setDayRouteList(dayRouteList);
    tripProduct.setTripRoute(customizeRoute);

    jsonResult = JSONConvertor.getJSONInstance().writeValueAsString(tripProduct);
    logger.info("Trip Product information:" + jsonResult);
    result.setBusinessResult(jsonResult);
    return result;
  }

  private List<TripDayRoute> groupTripDayRoute(String tripRouteId){
    List<POIRoute> routeList=tripPOIRouteDao.aggregateTripDayPOI(tripRouteId);
    for(POIRoute route:routeList){
      
    }
    return null;
  }
  
  public ServiceResult<String> listUserTripProducts(Long luckerId) {
    ServiceResult<String> result = new ServiceResult<String>();
    String jsonResult = null;
    List<TripProduct> tripProductList = tripProductDao.listTripProductByUser(luckerId);
    jsonResult = JSONConvertor.transformTripProducts2JSON(tripProductList);
    logger.info("Trip Product list:" + jsonResult);
    result.setBusinessResult(jsonResult);
    return result;
  }

  /**
   * list trip route detail
   */
  public ServiceResult<String> detailCustomizeRoute(String tripRouteId) {
    ServiceResult<String> result = new ServiceResult<String>();
    String jsonResult = null;
    CustomizeRoute customizeRoute = customizeRouteDao.getCustomizeRoute(tripRouteId);
    List<POIRoute> poiRouteList =  tripPOIRouteDao.aggregateTripDayPOI(tripRouteId);
    List<POIRoute> updateRouteList = new ArrayList<POIRoute>();
    for (POIRoute poiRoute : poiRouteList) {
      POIRoute dayRoute = tripPOIRouteDao.getTripPOIRoute(poiRoute.getPoiRouteId());
      updateRouteList.add(dayRoute);
    }
    customizeRoute.setPoiRouteList(updateRouteList);
    jsonResult = JSONConvertor.getJSONInstance().writeValueAsString(customizeRoute);
    logger.info("Customize Trip Product information:" + jsonResult);
    result.setBusinessResult(jsonResult);
    return result;
  }

  public ServiceResult<String> recommendTripProduct(Long userId) {
    // TODO Auto-generated method stub
    return null;
  }

  /**
   * generate customize trip route according to product order
   */
  public ServiceResult<String> customizeTripRoute(ProductOrder productOrder) {
    // TODO Auto-generated method stub
    return null;
  }


  public ServiceResult<String> getProductOrder(String productOrderId) {
    return null;
  }

  public void setTripProductDao(TripProductDao tripProductDao) {
    this.tripProductDao = tripProductDao;
  }

  public void setTripPOIRouteDao(TripPOIRouteDao tripPOIRouteDao) {
    this.tripPOIRouteDao = tripPOIRouteDao;
  }

  public void setCustomizeRouteDao(CustomizeRouteDao customizeRouteDao) {
    this.customizeRouteDao = customizeRouteDao;
  }

}
