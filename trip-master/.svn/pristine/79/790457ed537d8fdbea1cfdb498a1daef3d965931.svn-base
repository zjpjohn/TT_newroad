package com.newroad.tripmaster.util;

import java.lang.reflect.Field;
import java.lang.reflect.InvocationTargetException;
import java.util.Date;

import org.apache.commons.beanutils.BeanUtils;

import com.mongodb.BasicDBObject;
import com.mongodb.DBObject;

public class BeanDBObjectUtils {

  /**
   * 
   * @param bean
   * @return
   * @throws IllegalArgumentException
   * @throws IllegalAccessException
   */
  public static <T> DBObject bean2DBObject(T bean) throws IllegalArgumentException, IllegalAccessException {
    if (bean == null) {
      return null;
    }
    DBObject dbObject = new BasicDBObject();
    Field[] fields = bean.getClass().getDeclaredFields();
    for (Field field : fields) {
      String varName = field.getName();
      boolean accessFlag = field.isAccessible();
      if (!accessFlag) {
        field.setAccessible(true);
      }
      Object param = field.get(bean);
      if (param == null) {
        continue;
      } else if (param instanceof Integer) {// �жϱ���������
        int value = ((Integer) param).intValue();
        dbObject.put(varName, value);
      } else if (param instanceof String) {
        String value = (String) param;
        dbObject.put(varName, value);
      } else if (param instanceof Double) {
        double value = ((Double) param).doubleValue();
        dbObject.put(varName, value);
      } else if (param instanceof Float) {
        float value = ((Float) param).floatValue();
        dbObject.put(varName, value);
      } else if (param instanceof Long) {
        long value = ((Long) param).longValue();
        dbObject.put(varName, value);
      } else if (param instanceof Boolean) {
        boolean value = ((Boolean) param).booleanValue();
        dbObject.put(varName, value);
      } else if (param instanceof Date) {
        Date value = (Date) param;
        dbObject.put(varName, value);
      }
      field.setAccessible(accessFlag);
    }
    return dbObject;
  }

  /**
   * 
   * @param dbObject
   * @param bean
   * @return
   * @throws IllegalAccessException
   * @throws InvocationTargetException
   * @throws NoSuchMethodException
   */
  public static <T> T dbObject2Bean(DBObject dbObject, T bean) {
    if (bean == null) {
      return null;
    }
    Field[] fields = bean.getClass().getDeclaredFields();
    try {
      for (Field field : fields) {
        String varName = field.getName();
        Object object = dbObject.get(varName);
        if (object != null) {
          if (object instanceof DBObject) {
            BeanUtils.setProperty(bean, varName, dbObject2Bean((DBObject)object,field.getType().newInstance()));
          } else {
            BeanUtils.setProperty(bean, varName, object);
          }
        }
      }
    } catch (IllegalAccessException e) {
      // TODO Auto-generated catch block
      e.printStackTrace();
    } catch (InvocationTargetException e) {
      // TODO Auto-generated catch block
      e.printStackTrace();
    } catch (InstantiationException e) {
      // TODO Auto-generated catch block
      e.printStackTrace();
    }
    return bean;
  }

}
