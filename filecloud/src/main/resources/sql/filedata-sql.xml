<?xml version="1.0" encoding="UTF-8" ?>
<!-- 资源 -->
<sqls>
	<mapping id="resource" class="com.lenovo.fileext.data.model.FileResource">
		<property column="_id"  name="resourceID"/>
		<property column="clientResourceID"  name="clientResourceID"/>
		<property column="resourceName"  name="resourceName"/>
		<property column="resourceType"  name="resourceType"/>
		<property column="description"  name="description"/>
		<property column="size"  name="size"/>
		<property column="fileData" name="fileData">
			<value class="com.lenovo.fileext.data.model.CloudFileData">
				<property column="bucketName"  name="bucketName"/>
				<property column="keyID"  name="keyID"/>
				<property column="fileName"  name="fileName"/>
				<property column="contentType"  name="contentType"/>
				<property column="link"  name="link"/>
				<property column="publicLink"  name="publicLink"/>
				<property column="cloudSize"  name="cloudSize"/>
				<property column="offset"  name="offset"/>
				<property column="fileCachePath" name="fileCachePath"/>
				<property column="cloudStatus" name="cloudStatus"/>
			</value>
		</property>
		<!-- 
		<property column="thumbnailCacheList"  name="thumbnailCacheList">
			<value class="com.lenovo.fileext.data.model.ThumbnailCache">
				<property column="thumbnailType"    name="thumbnailType" />
				<property column="thumbnailCachePath"    name="thumbnailCachePath" />
			</value>
		</property>
		 -->
		<property column="startTime"  name="startTime"/>
		<property column="fullTime"  name="fullTime"/>
		<property column="userID"  name="userID"/>
		<property column="noteID"  name="noteID"/>
		<property column="version"  name="resourceVersion"/>
		<property column="status"  name="status"/>
		<property column="userCreateTime"  name="userCreateTime"/>
		<property column="createTime"  name="createTime"/>
		<property column="lastUpdateTime"  name="lastUpdateTime"/>
	</mapping>
	
	<!-- 根据附件keyID取资源信息 -->
	<select id="getFileDataByKeyID" collection="ln_resource">
		<property name="param" class="java.util.Map">
			<value column="fileData.keyID" name="fileData.keyID"/>
			<value column="status" name="status" operate="$in" />
		</property>
		<property name="result"  mapping="resource" />
	</select>
	
	<update id="updateFileDataByKeyID" collection="ln_resource">
		<porperty name="param" class="java.util.Map">
			<value column="fileData.keyID" name="fileData.keyID" value="not exists"/>
		</porperty>
		<property name="action" class="java.util.Map">
			<value column="resourceName"  name="resourceName" operate="$set"/>
			<value column="resourceType"  name="resourceType" operate="$set"/>
			<value column="fileData.fileName"  name="fileData.fileName" operate="$set"/>
		    <value column="fileData.fileCachePath"  name="fileData.fileCachePath" operate="$set"/>
			<value column="fileData.contentType"  name="fileData.contentType" operate="$set"/>
			<value column="fileData.cloudSize"  name="fileData.cloudSize" type="long" operate="$set"/>
			<value column="fileData.cloudStatus"  name="fileData.cloudStatus" type="long" operate="$set"/>
			<value column="size"  name="size" type="long" operate="$set"/>
			<value column="status"  name="status" type="int" operate="$set" />
			<value column="lastUpdatedTime"  name="lastUpdatedTime" type="long" operate="$set"  value=""/>
			<value column="version" operate="$inc"  value="1" type="long" />
		</property>
	</update>
	
	<update id="deleteFileDataByKeyID" collection="ln_resource">
		<porperty name="param" class="java.util.Map">
			<value column="fileData.keyID" name="fileData.keyID" value="not exists"/>
		</porperty>
		<property name="action">
			<value column="status" name="status" type="int" operate="$set"  value="2"/>
			<value column="version" operate="$inc"  value="1" type="long" />
		</property>
	</update>
	
	<!-- 根据附件keyID取资源信息 -->
	<select id="getFileDataByClientID" collection="ln_resource">
		<property name="param" class="java.util.Map">
			<value column="clientResourceID" name="clientResourceID"/>
			<value column="userID" name="userID"/>
			<value column="status" name="status" operate="$in" />
		</property>
		<property name="result"  mapping="resource" />
	</select>
	
	<update id="updateFileDataByClientID" collection="ln_resource">
		<porperty name="param" class="java.util.Map">
			<value column="clientResourceID" name="clientResourceID" value="not exists"/>
		</porperty>
		<property name="action" class="java.util.Map">
			<value column="resourceName"  name="resourceName" operate="$set"/>
			<value column="resourceType"  name="resourceType" operate="$set"/>
			<value column="fileData.fileName"  name="fileData.fileName" operate="$set"/>
		    <value column="fileData.fileCachePath"  name="fileData.fileCachePath" operate="$set"/>
			<value column="fileData.contentType"  name="fileData.contentType" operate="$set"/>
			<value column="fileData.cloudSize"  name="fileData.cloudSize" type="long" operate="$set"/>
			<value column="fileData.cloudStatus"  name="fileData.cloudStatus" type="long" operate="$set"/>
			<value column="size"  name="size" type="long" operate="$set"/>
			<value column="status"  name="status" type="int" operate="$set" />
			<value column="lastUpdatedTime"  name="lastUpdatedTime" type="long" operate="$set"  value=""/>
			<value column="version" operate="$inc"  value="1" type="long" />
		</property>
	</update>
	
	<update id="deleteFileDataByClientID" collection="ln_resource">
		<porperty name="param" class="java.util.Map">
			<value column="clientResourceID" name="clientResourceID" value="not exists"/>
		</porperty>
		<property name="action">
			<value column="status" name="status" type="int" operate="$set"  value="2"/>
			<value column="version" operate="$inc"  value="1" type="long" />
		</property>
	</update>
	
	<update id="updateResourcePublicLink" collection="ln_resource">
		<porperty name="param" class="java.util.Map">
			<value column="fileData.keyID" name="key" operate="$in" value="-1"/>
		</porperty>
		<property name="action">
			<value column="fileData.publicLink" operate="$set" name="public_link" value="null"/>
		</property>
	</update>
	
	<!-- 根据附件ID取资源信息 -->
	<select id="getFileDataByID" collection="ln_resource">
		<property name="param" class="java.util.Map">
			<value column="_id" name="${value}"  type="objectid" value="not exists" />
		</property>
		<property name="result"  mapping="resource" />
	</select>
	
	<select id="getFileListByStatus" collection="ln_resource">
		<property name="param" class="java.util.Map">
			<value column="status"  name="status" operate="$in" />
		</property>
		<property name="result"  mapping="resource" />
	</select>
	
	<select id="getFileListByCloudStatus" collection="ln_resource">
		<property name="param" class="java.util.Map">
			<value column="fileData.cloudStatus"  name="fileData.cloudStatus" value="not exists"/>
		</property>
		<property name="result"  mapping="resource" />
	</select>
	
	<!-- 添加资源信息 -->
	<insert id="insertFileData" collection="ln_resource">
		<property name="param"  mapping="resource" />
	</insert>
	
	<update id="syncCloudFileStatus" collection="ln_resource">
		<porperty name="param" class="java.util.Map">
			<value column="userID" name="userID" value=""/>
			<value column="fileData.keyID" name="fileData.keyID" value="not exists"/>
		</porperty>
		<property name="action">
			<value column="fileData.cloudSize"  name="cloudSize" operate="$set"/>
			<value column="fileData.cloudStatus"  name="cloudStatus" operate="$set" value="1" />
			<value column="lastUpdatedTime"  name="lastUpdatedTime" type="long" operate="$set"  value=""/>
		</property>
	</update>
	
</sqls>
